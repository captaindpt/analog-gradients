* MIM Memristor â€” SDevice Physics Deck (Phase 3: Defect Drift)
* Adds mobile oxygen vacancies for state-dependent behavior.
* Substitute: %%SWEEP_VMAX%%, %%TRAP_DENSITY%%, %%TRAP_ENERGY_EV%%,
*             %%VACANCY_CONC%%, %%VACANCY_MOBILITY%%

File {
  Grid    = "memdev_msh.tdr"
  Plot    = "memdev"
  Current = "memdev"
  Output  = "memdev"
}

Electrode {
  { Name="top"    Voltage=0.0 }
  { Name="bottom" Voltage=0.0 }
}

Physics {
  DefaultParametersFromFile
  Fermi
  Mobility( DopingDep HighFieldSaturation Enormal )
  Recombination( SRH )
  EffectiveIntrinsicDensity( OldSlotboom )
  eBarrierTunneling "NLM_TOP"
  hBarrierTunneling "NLM_TOP"
  eBarrierTunneling "NLM_BOT"
  hBarrierTunneling "NLM_BOT"
}

Physics (Region="R.Oxide") {
  Traps(
    (Acceptor Level fromCondBand
     EnergyMid=%%TRAP_ENERGY_EV%%
     Conc=%%TRAP_DENSITY%%
     TrapVolume=1e-21
     eXsection=1e-15 hXsection=1e-15
     eBarrierTunneling(NonLocal= "NLM_TOP" NonLocal= "NLM_BOT")
     hBarrierTunneling(NonLocal= "NLM_TOP" NonLocal= "NLM_BOT"))
  )
  * Mobile charged defects: oxygen vacancies acting as donors
  * These drift under electric field, forming/dissolving the conductive filament
  Traps(
    (Donor Level EnergyMid=0.0
     Conc=%%VACANCY_CONC%%
     eXsection=1e-14 hXsection=1e-14
     SpaceMobility=%%VACANCY_MOBILITY%%)
  )
}

Plot {
  eDensity hDensity eCurrent hCurrent
  ElectricField Potential SpaceCharge
  eTrappedCharge hTrappedCharge
  TotalCurrent
}

Math {
  NonLocal "NLM_TOP" (
    Electrode = "top"
    Length = 2e-6
    Digits = 4
    EnergyResolution = 1e-4
  )
  NonLocal "NLM_BOT" (
    Electrode = "bottom"
    Length = 2e-6
    Digits = 4
    EnergyResolution = 1e-4
  )
  Extrapolate
  RelErrControl
  Notdamped=50
  Iterations=40
  Method=Blocked
  SubMethod=ParDiSo
}

Solve {
  * Initial equilibrium
  Coupled(Iterations=100){ Poisson }
  Coupled(Iterations=100){ Poisson Electron Hole }

  * Cycle 1: bipolar sweep
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=-%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=0.0 }
  ) {
    Coupled { Poisson Electron Hole }
  }

  * Cycle 2: repeat to check for state change
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=-%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=0.0 }
  ) {
    Coupled { Poisson Electron Hole }
  }

  * Cycle 3: third sweep for trend confirmation
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=-%%SWEEP_VMAX%% }
  ) {
    Coupled { Poisson Electron Hole }
  }
  Quasistationary(
    InitialStep=0.005
    Increment=1.3
    MinStep=1e-7
    MaxStep=0.02
    Goal{ Name="top" Voltage=0.0 }
  ) {
    Coupled { Poisson Electron Hole }
  }
}
